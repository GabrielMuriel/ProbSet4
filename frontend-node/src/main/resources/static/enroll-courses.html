<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
  </head>
  <body> 
    <div style="text-align: center; margin: 24px;">
        <h1>LFGN Enrollment System</h1>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>

        <a href="/index.html"><p>Back to Home Page</p></a>
    </div>

    <!-- REPLACE THIS PART BELOW FOR NEW HTML PAGES -->
    <div class="border-top border-2" style="margin-left: 24px; margin-right: 24px;">
        <h2 style="margin-top: 16px;">Enroll to Open Courses</h2>
        <p style="margin-bottom: 16px;">You may enroll in your preferred courses here.</p>

        <!-- Dropdown -->
        <div class="mb-3">
            <label for="courseSelect" class="form-label">Select Course</label>
            <select id="courseSelect" class="form-select">
                <option selected disabled>Choose a course</option>
            </select>
        </div>

        <!-- Course info -->
        <div id="courseInfo" class="card p-3 mb-3" style="display:none;">
            <h5>Course Details</h5>
            <p><strong>Course Code:</strong> <span id="idcourses"></span></p>
            <p><strong>Course Name:</strong> <span id="courseName"></span></p>
            <p><strong>Faculty:</strong> <span id="facultyID"></span></p>
            <!--<p><strong>Number of Enrolled Students:</strong> <span id="enrolledNum"></span></p>
            <p><strong>Enrollment Cap:</strong> <span id="enrollmentCap"></span></p>-->

            <!-- Enroll button -->
            <button id="enrollBtn" class="btn btn-success">Enroll</button>
        </div>

    </div>

    <script>
        let selectedCourse = null;

        // Fetch courses and populate dropdown
        window.onload = function () {
            fetch('http://localhost:8082/courses')
                .then(res => res.json())
                .then(courses => {
                    const select = document.getElementById('courseSelect');
                    courses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.idcourses;
                        option.textContent = `${course.courseName} (${course.idcourses})`;
                        option.dataset.course = JSON.stringify(course);  // Save full course info
                        select.appendChild(option);
                    });
                });
        };

        // Show course details on selection
        document.getElementById('courseSelect').addEventListener('change', function () {
            const selectedOption = this.options[this.selectedIndex];
            const course = JSON.parse(selectedOption.dataset.course);
            selectedCourse = course;

            document.getElementById('idcourses').innerText = course.idcourses;
            document.getElementById('courseName').innerText = course.courseName;
            document.getElementById('facultyID').innerText = course.facultyID;
            // document.getElementById('enrolledNum').innerText = course.enrolledNum;
            // document.getElementById('enrollmentCap').innerText = course.enrollmentCap;

            document.getElementById('courseInfo').style.display = 'block';
        });

        // Enroll action
        document.getElementById('enrollBtn').addEventListener('click', function () {
            const studentId = 1; // Replace with actual student ID from login/session

            fetch('http://localhost:8082/courses/enroll', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    studentID: studentId,
                    courseID: selectedCourse.idcourses
                })
            })
                .then(res => res.text())
                .then(msg => {
                    alert(`Enrollment status: ${msg}`);
                })
                .catch(err => {
                    alert('Enrollment failed.');
                    console.error(err);
                });
        });
    </script>

  </body>
</html>